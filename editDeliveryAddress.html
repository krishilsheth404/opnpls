<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Generated by Codia AI</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Uber+Move+Text:wght@400;500&display=swap" />
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
          
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js" integrity="sha512-LUKzDoJKOLqnxGWWIBM4lzRBlxcva2ZTztO8bTcWPmDSpkErWx0bSP4pdsjNH8kiHAUPaT06UXcb+vOEZH+HpQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.js" integrity="sha512-A/D/17S8jG62ka9f3jPwMs+bKGJ1f/xQts7bAUjTIKQf0anTGjlpuEz3q9q++3qRAVYKS3iVx6KzM8GPtIaYfw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cheerio/0.22.0/index.js" integrity="sha512-+obmGUxyA+OfXW4RU7Ez2JBbCFy+dmZatW/Z5u/PDZlY+SKzAMSHzpNfTDohw7RFfW+zmLrI9h19XiODWZRO5A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cheerio/0.22.0/index.min.js" integrity="sha512-e0BgZBWe7/3JF1To6KxVcaoki2aQd3f6aWyRf9R+dOPgDUfn7czha9/wLHzNgVmUaORT2cEq+lyjxjoQmPEiHA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>



  </head>
  <style>
    :root {
  --default-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
    Ubuntu, "Helvetica Neue", Helvetica, Arial, "PingFang SC",
    "Hiragino Sans GB", "Microsoft Yahei UI", "Microsoft Yahei",
    "Source Han Sans CN", sans-serif;
}

.main-container {
  overflow: hidden;
}

.main-container,
.main-container * {
  box-sizing: border-box;
}

input,
select,
textarea,
button {
  outline: 0;
}

.main-container {
  position: relative;
  width: 375px;
  height: 812px;
  margin: 0 auto;
  background: #ffffff;
  overflow: hidden;
}
.iphone-x {
  position: relative;
  width: 375px;
  height: 44px;
  margin: 0 0 0 0;
  z-index: 3;
  overflow: hidden;
}
.left-side {
  position: absolute;
  width: 54px;
  height: 21px;
  top: 12px;
  left: 21px;
  z-index: 8;
  border-radius: 32px;
}
.time {
  position: absolute;
  width: 54px;
  height: 21px;
  top: 0;
  left: 0;
  z-index: 9;
  border-radius: 32px;
}
.colon {
  position: relative;
  width: 28.426px;
  height: 11.089px;
  margin: 5.167px 0 0 12.453px;
  background: url(./assets/images/97ead717-1a1f-4caf-a569-3a862095bc69.png)
    no-repeat center;
  background-size: cover;
  z-index: 10;
}
.right-side {
  position: absolute;
  width: 66.661px;
  height: 11.336px;
  top: 17.331px;
  left: 293.667px;
  z-index: 4;
}
.wifi {
  position: absolute;
  width: 22.91%;
  height: 96.73%;
  top: 0;
  left: 33.04%;
  background: url(./assets/images/2babdea1-46f2-4648-b9e2-7096d6ce9f15.png)
    no-repeat center;
  background-size: 100% 100%;
  z-index: 6;
}
.battery {
  position: absolute;
  width: 24.328px;
  height: 11.333px;
  top: 0px;
  right: 0px;
  background: url(./assets/images/a3cf220b-96d5-4bdf-8dcf-9819f61442ea.png)
    no-repeat center;
  background-size: cover;
  z-index: 5;
}
.mobile-signal {
  position: absolute;
  width: 25.5%;
  height: 94.1%;
  top: 2.96%;
  left: 0;
  background: url(./assets/images/d112303c-e75b-4783-b4d2-8838ce493a2b.png)
    no-repeat center;
  background-size: 100% 100%;
  z-index: 7;
}
.parallax-header-variant {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  flex-wrap: nowrap;
  gap: 10px;
  position: relative;
  width: 375px;
  margin: -6px 0 0 0;
  z-index: 11;
}
.header {
  display: flex;
  align-items: center;
  flex-wrap: nowrap;
  flex-shrink: 0;
  gap: 16px;
  position: relative;
  width: 375px;
  padding: 16px 16px 16px 16px;
  z-index: 12;
}
.vector {
  flex-shrink: 0;
  position: relative;
  width: 21.042px;
  height: 18px;
  background: url(./assets/images/9afd0eb9-1332-4be1-9645-d813acb473fd.png)
    no-repeat center;
  background-size: cover;
  z-index: 13;
}
.convenience {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  flex-shrink: 0;
  flex-basis: auto;
  position: relative;
  width: 144.792px;
  height: 24px;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 20px;
  font-weight: 400;
  line-height: 24px;
  text-align: left;
  white-space: nowrap;
  z-index: 14;
}
.rectangle {
  position: relative;
  width: 375px;
  height: 77px;
  margin: 0 0 0 0;
  background: #ffffff;
  z-index: 15;
}
.button {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: nowrap;
  gap: 10px;
  position: absolute;
  width: 94px;
  height: 40px;
  top: 19px;
  left: 262px;
  padding: 10px 16px 10px 16px;
  cursor: pointer;
  background: #eeeeee;
  border: none;
  z-index: 22;
  border-radius: 99px;
}
.shop-now {
  flex-shrink: 0;
  flex-basis: auto;
  position: relative;
  height: 20px;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 14px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 23;
}
.when {
  position: absolute;
  width: 24px;
  height: 24px;
  top: 27px;
  left: 16px;
  background: url(./assets/images/538d4969102d1b4f55ddb203865127be532e60f4.png)
    no-repeat center;
  background-size: cover;
  z-index: 17;
}
.deliver-now {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  position: absolute;
  height: 20px;
  top: 29px;
  left: 62px;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 18;
}
.rectangle-1 {
  position: relative;
  width: 340px;
  height: 44px;
  margin: 30px 0 0 16px;
  background: #eeeeee;
  z-index: 27;
}
.input {
      position: absolute;
    width: 308px;
    height: 44px;
    top: 0;
    left: 33px;
    background: transparent;
    border: none;
    z-index: 31;
    outline: none;
    border-radius: 5px;
    
}
.search {
  position: absolute;
  width: 24px;
  height: 24px;
  top: 10px;
  left: 11px;
  z-index: 29;
  overflow: hidden;
}
.vector-2 {
  position: relative;
  width: 18px;
  height: 18px;
  margin: 2.75px 0 0 2.833px;
  background: url(./assets/images/cd536b70-bbaf-4b5d-b283-07bf20c7caeb.png)
    no-repeat center;
  background-size: 100% 100%;
  z-index: 30;
}
.enter-promo-code {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  position: absolute;
  height: 20px;
  top: 12px;
  left: 43px;
  color: #6b6b6b;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 400;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 28;
}
.nearby {
  display: block;
  position: relative;
  height: 20px;
  margin: 20px 0 0 16px;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 19;
}
.recent-locations {
  display: block;
  position: relative;
  height: 20px;
  margin: 74px 0 0 23px;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 20;
}
.frame {
  position: relative;
  width: 375px;
  height: 103px;
  margin: 8px 0 0 0;
  background: #eeeeee;
  z-index: 37;
  overflow: hidden;
}
.flex-column {
  position: absolute;
  width: 316px;
  height: 70px;
  top: 33px;
  left: 59px;
  font-size: 0px;
  z-index: 45;
}
.san-francisco-bay-area {
  display: block;
  position: relative;
  height: 20px;
  margin: 0 0 0 0;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 38;
}
.ca {
  display: block;
  position: relative;
  height: 20px;
  margin: 3px 0 0 3px;
  color: #6b6b6b;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 39;
}
.rectangle-3 {
  position: relative;
  width: 316px;
  height: 1px;
  margin: 26px 0 0 0;
  background: url(./assets/images/2c66f82f-02ac-47f5-898e-d112bf01fab2.png)
    no-repeat center;
  background-size: cover;
  z-index: 45;
}
.edit {
  position: absolute;
  width: 37px;
  height: 37px;
  top: 39px;
  left: 313px;
  z-index: 40;
}
.edit-4 {
  position: relative;
  width: 17px;
  height: 15.111px;
  margin: 11px 0 0 10px;
  z-index: 42;
}
.union {
  position: absolute;
  width: 21.463px;
  height: 17.496px;
  top: 0;
  left: 0;
  background: url(./assets/images/fd367711-31c2-4ef0-91f3-839274e0a9e3.png)
    no-repeat center;
  background-size: cover;
  z-index: 43;
}
.ellipse {
  position: absolute;
  width: 37px;
  height: 37px;
  top: 0;
  left: 0;
  background: url(./assets/images/5b94e0c2-5742-4efb-95e3-da189eb4a7b4.png)
    no-repeat center;
  background-size: cover;
  z-index: 41;
  border-radius: 50%;
}
.expanded-radius-icon {
  position: absolute;
  width: 22px;
  height: 28px;
  top: 42px;
  left: 18px;
  background: url(./assets/images/f6016091-d0a7-40bf-a7bd-a99c5283207f.png)
    no-repeat center;
  background-size: cover;
  z-index: 44;
}
.frame-5 {
  position: relative;
  width: 375px;
  height: 103px;
  margin: 0 0 0 0;
  background: #ffffff;
  z-index: 47;
  overflow: hidden;
}
.flex-column-d {
  position: absolute;
  width: 316px;
  height: 71px;
  top: 32px;
  left: 59px;
  font-size: 0px;
  z-index: 55;
}
.carlifornia-city {
  display: block;
  position: relative;
  height: 20px;
  margin: 0 0 0 3px;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 48;
}
.ca-6 {
  display: block;
  position: relative;
  height: 20px;
  margin: 4px 0 0 3px;
  color: #6b6b6b;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 49;
}
.rectangle-7 {
  position: relative;
  width: 316px;
  height: 1px;
  margin: 26px 0 0 0;
  background: url(./assets/images/7b682374-74bc-4e06-b52e-21014fddaa3f.png)
    no-repeat center;
  background-size: cover;
  z-index: 55;
}
.edit-8 {
  position: absolute;
  width: 37px;
  height: 37px;
  top: 39px;
  left: 313px;
  z-index: 50;
}
.edit-9 {
  position: relative;
  width: 17px;
  height: 15.111px;
  margin: 11px 0 0 10px;
  z-index: 52;
}
.union-a {
  position: absolute;
  width: 21.463px;
  height: 17.496px;
  top: 0;
  left: 0;
  background: url(./assets/images/ce9f171f-a7fc-4ad9-99c4-dffd57a21bf7.png)
    no-repeat center;
  background-size: cover;
  z-index: 53;
}
.ellipse-b {
  position: absolute;
  width: 37px;
  height: 37px;
  top: 0;
  left: 0;
  background: url(./assets/images/51c33ba4-8bcb-4a1a-8f20-786652d860e6.png)
    no-repeat center;
  background-size: cover;
  z-index: 51;
  border-radius: 50%;
}
.expanded-radius-icon-c {
  position: absolute;
  width: 22px;
  height: 28px;
  top: 44px;
  left: 19px;
  background: url(./assets/images/8c4a41b1-b7b1-4f2b-8af2-c99871d7ee9e.png)
    no-repeat center;
  background-size: cover;
  z-index: 54;
}
.home-indicator {
  position: relative;
  width: 134px;
  height: 5px;
  margin: 206px 0 0 121px;
  background: #111111;
  z-index: 1;
  border-radius: 100px;
}
.rectangle-d {
  position: absolute;
  width: 375px;
  height: 10px;
  top: 171px;
  left: 0;
  background: url(./assets/images/503bee80-e4fd-43b9-9d10-c23ac08747d3.png)
    no-repeat center;
  background-size: cover;
  z-index: 24;
}
.button-e {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-wrap: nowrap;
  gap: 10px;
  position: absolute;
  width: 81px;
  height: 40px;
  top: 293px;
  left: 70%;
  padding: 10px 18px 10px 18px;
  cursor: pointer;
  background: #eeeeee;
  border: none;
  z-index: 34;
  border-radius: 99px;
}
.shop-now-f {
  flex-shrink: 0;
  flex-basis: auto;
  position: relative;
  height: 20px;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 14px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 35;
}
.polygon {
  position: absolute;
  width: 32.224px;
  height: 32.506px;
  top: 297px;
  left: 19px;
  background: url(./assets/images/c34210ab-590a-4b49-b00d-ec29dc7bcea1.png)
    no-repeat center;
  background-size: cover;
  z-index: 33;
}
.current-location {
  display: flex;
  align-items: flex-start;
  justify-content: flex-start;
  position: absolute;
  height: 20px;
  top: 303px;
  left: 62px;
  color: #000000;
  font-family: Uber Move Text, var(--default-font-family);
  font-size: 16px;
  font-weight: 500;
  line-height: 20px;
  text-align: left;
  white-space: nowrap;
  z-index: 21;
}
.rectangle-10 {
  position: absolute;
  width: 375px;
  height: 2px;
  top: 345px;
  left: 0;
  background: url(./assets/images/a24d372e-e385-4d6e-be0a-6fea395d0b2b.png)
    no-repeat center;
  background-size: cover;
  z-index: 25;
}

  </style>
  <body>
    <div class="main-container" style="width: 100%;height: 100%;">
      <div class="iphone-x">
        <div class="left-side">
          <div class="time"><div class="colon"></div></div>
        </div>
        <div class="right-side">
          <div class="wifi"></div>
          <div class="battery"></div>
          <div class="mobile-signal"></div>
        </div>
      </div>
      <div class="parallax-header-variant">
        <div class="header" style="padding-left: 10px;">
          <div class="vector">
            <a href="index.html">
                <i class='bx bx-chevron-left' style="font-size: 26px;position: relative;top: -2px;"></i>
            </a>
          </div>
          <span class="convenience">Delivery Address</span>
        </div>
      </div>
    
      <div class="rectangle-1" style="display: flex;align-items: center;width: 92%;margin-left: auto;margin: auto;margin-top: 30px;height: 50px;border-radius: 5px;background: #f4f4f4;">
        <input class="input" id="addressInput" placeholder="Enter Your Location" id="locationAutocomplete" style="height: 50px;">
        <i class="bx bx-current-location" style="position: relative;
        left: 7px;
        font-size: 23px;
        top: 0px;"></i>
    </div>

    <div id="autoCompleteAddresses" style="    background: #f4f4f4;
    width: 92%;
    height: auto;
    margin: auto;
    margin-top: 10px;border-radius: 5px;padding-bottom: 0px;z-index: 10000;    position: absolute;
    left: 50%;
    transform: translate(-50%);">
    
  </div>
  

  <span class="nearby" style="    text-align: center">OR</span
    >

    <div class="realLlocation" style="/* margin-top: 500px; */height: 100px;/* background: red; */position: relative;">
      <button class="button-e" id="enableLocation" style="
top: 10px;
"><span class="shop-now-f">Enable</span></button>
      <div class="polygon" style="display: flex;align-items: center;top: 10px;justify-content: center;">
          <i class="bx bxs-location-plus" style="font-size: 23px;"></i>
        </div>
        <span class="current-location" style="
top: 15px;
">Current location</span>
    </div>


    
    <div id="savedAddress" style="width: 92%;margin: auto;font-family: Inter, var(--default-font-family);display: none;">
      <div>Saved Address</div>
      <div id="allSavedAddressSection">

    
      </div>
    </div>


  
     
  

    <form id="savedNewAddressForm">

    <div id="repeatedSection" style="visibility: hidden;">
  <div id="mapArea" style="height: 300px;
  width: 92%;
  margin: auto;
  background:transparent;
  overflow: hidden;margin-top: 40px;">
    <div id="map" style="height: 320px;width: 100%;border-radius: 5px;"></div>
  </div>


  <div class="input-group" style="width: 92%; margin: auto; margin-top: 20px;">
    <label class="radio">
        <input class="radio__input" id="category" name="category" type="radio" value="Home" required />
        <span class="radio__label">Home</span>
    </label>
    <label class="radio">
        <input class="radio__input" id="category" name="category" type="radio" value="Office" />
        <span class="radio__label">Office</span>
    </label>
    <label class="radio">
        <input class="radio__input" id="category" name="category" type="radio" value="Other" />
        <span class="radio__label">Other</span>
    </label>
</div>


 
 
  <div class="rectangle-1" style="display: flex;align-items: center;width: 92%;margin-left: auto;margin: auto;margin-top: 30px;height: 50px;border-radius: 5px;background: #f4f4f4;margin-top: 60px;">
    <span style="position: absolute;top: -35px;left: 4px;font-family: Inter, var(--default-font-family);">Enter Detailed Address (*)</span>
    <input class="input" required id="fullAddress" name="fullAddress" placeholder="Company , Building *" id="locationAutocomplete" style="height: 50px;left: 15px;">
  </div>
  <div class="rectangle-1" style="display: flex;align-items: center;width: 92%;margin-left: auto;margin: auto;margin-top: 10px;height: 50px;border-radius: 5px;background: #f4f4f4;">
    <input class="input" required id="fullAddress" name="fullAddress" placeholder="Floor *" id="locationAutocomplete" style="height: 50px;left: 15px;">
  </div>
  <div class="rectangle-1" style="display: flex;align-items: center;width: 92%;margin-left: auto;margin: auto;margin-top: 10px;height: 50px;border-radius: 5px;background: #f4f4f4;">
    <input class="input" id="fullAddress" name="fullAddress" placeholder="Nearby Landmark (optional)" id="locationAutocomplete" style="height: 50px;left: 15px;">
  </div>
  <input class="input" id="NewAddress_lat" name="lat" id="lat" style="height: 50px;left: 15px;display: none;">
  <input class="input" id="NewAddress_lng" name="lng" id="lng" style="height: 50px;left: 15px;display: none;">

 

  
  <input type="submit" name="submit" id="submit" value="Confirm Address" style="    height: 50px;
  width: 92%;
  border-radius: 5px;
  background: linear-gradient(63deg, #00612d, #55b46e);
  margin-bottom: 80px;
  color: white;
  font-family: Inter, var(--default-font-family);
  display: grid
;
  place-content: center;
  margin: auto;
  margin-top: 30px;
  margin-bottom: 30px;cursor: pointer;border: none;font-size: 17px;">

    </div>

  </form>

  <script>
    document.getElementById('savedNewAddressForm').addEventListener('submit', async function(event) {
    event.preventDefault();  // Prevent default form submission

    // Get selected category
    const selectedCategory = document.querySelector('input[name="category"]:checked').value;
    console.log(selectedCategory)

    // Get form values
    const fullAddress = document.getElementById('fullAddress').value;
    const lat = document.getElementById('NewAddress_lat').value;
    const lng = document.getElementById('NewAddress_lng').value;

    // Concatenate address data into full address string
    const fullAddressData = fullAddress.toString();

    // Create data object to send to server
    const addressData = {
        category: selectedCategory,
        fullAddress: fullAddress.trim(),
        lat: lat,
        lng: lng
    };

    // Send data to server using Axios
    await axios.post('/saveNewAddress', addressData)
        .then(response => {
            console.log("Address saved:", response.data);
            if (response.data.success) {
                // Redirect or display success message
                alert('Address saved successfully!');
                window.location.href = '/home'; // For example, redirect to homepage
            } else {
                alert('Failed to save address.');
            }
        })
        .catch(error => {
            console.error("Error saving address:", error);
            alert('Error saving address.');
        });
});

  </script>



    </div>
  </body>

<script>
  let debounceTimer;

  async function getAutocomplete(query) {
      const response = await fetch(`https://nominatim.openstreetmap.org/search?q=${query}&countrycodes=IN&format=json&addressdetails=1&limit=5`);
      if (!response.ok) throw new Error("API error");
      const data = await response.json();
      // Return detailed results including display_name and pincode
      return data.map(item => ({
        display_name: item.display_name,
        pincode: item.address.postcode || "N/A",
        city: item.address.city || item.address.town || item.address.village || "N/A",
        latitude: item.lat,
        longitude: item.lon,
    }));
  }

  // Autocomplete input event listener
  const inputField = document.getElementById("addressInput");
  const suggestionBox = document.getElementById("autoCompleteAddresses");

  inputField.addEventListener("input", (e) => {
      clearTimeout(debounceTimer); // Clear previous timer
      const query = e.target.value;

      if (query.length < 3) {
          suggestionBox.style.paddingBottom = `0px`;
          suggestionBox.innerHTML = ``;
          return;
      }

      // Set a new timer for 300ms
      debounceTimer = setTimeout(async () => {
          try {
              const suggestions = await getAutocomplete(query);
              console.log(suggestions); // Log suggestions for debugging
              suggestionBox.style.paddingBottom = `0px`;

              // Create and display suggestions
              if (suggestions.length > 0) {
                  suggestionBox.style.paddingBottom = `10px`;
                  suggestionBox.style.background= `#f4f4f4`;
                  const suggestionsHTML = suggestions.map(item => `
                      <div class="suggestion-item" onclick="setMapPosition(${parseFloat(item.latitude)},${parseFloat(item.longitude)})" style="padding: 10px;
    font-family: var(--default-font-family);
    margin-bottom: 10px;
    margin-top: 10px;cursor:pointer" onclick="selectAddress('${item.display_name}', '${item.city}')">
                          <strong>${item.city}</strong> <br>
                          <small>${item.display_name}</small>
                      </div>
                  `).join('');
                  suggestionBox.innerHTML = suggestionsHTML;
              } else {
                  suggestionBox.innerHTML = `<div class="suggestion-item">No results found</div>`;
              }
          } catch (error) {
              console.error("Error fetching suggestions:", error);
              suggestionBox.innerHTML = `<div class="suggestion-item">Error fetching results</div>`;
          }
      }, 300); // 300ms debounce delay
  });

  // Function to handle selection of an address
  function selectAddress(displayName, city) {
      document.getElementById("repeatedSection").style.display="block";
      inputField.value = `${city} , ${displayName}`;
      suggestionBox.innerHTML = ``; // Clear suggestions
  }

  async function selectSavedAddress(displayName, city, addressId) {
    try {
        // Send a POST request to update the selected address
        const response = await axios.post('/updateSelectedAddress', { addressId });

        // Check if the request was successful
        if (response.data.success) {
          window.location.href = "/"; // Redirect to the homepage

        } else {
            console.error("Failed to update selected address:", response.data.message);
        }
    } catch (error) {
        console.error("Error updating selected address:", error);
    }
}

</script>

<!-- For Leaflet Maps-->
<script>

    // Example: Coordinates for the user's current location
    const lat = 19.0760; // Replace with your latitude
  const lng = 72.8777; // Replace with your longitude


      // Create the map instance centered on the provided coordinates
      const map = L.map('map').setView([lat, lng], 13);

      // Add the tile layer
      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://carto.com/attributions">CartoDB</a>'
      }).addTo(map);

      // Define the custom icon
      const locationIcon = L.icon({
          iconUrl: 'locationIcon.svg', // Path to your icon file
          iconSize: [32, 32],         // Size of the icon
          iconAnchor: [16, 32],       // Anchor point of the icon
          popupAnchor: [0, -32]       // Anchor point for the popup
      });

      // Add the marker with the custom icon
      const draggableMarker = L.marker([lat,lng], {
            draggable: true,
            icon: L.icon({
                iconUrl: 'locationIcon.svg', // Custom icon URL
                iconSize: [40, 40], // Size of the icon
                iconAnchor: [20, 40], // Point of the icon which will correspond to marker's location
            })
        }).addTo(map);

        function setMapPosition(lat, lng) {
          document.getElementById("repeatedSection").style.visibility="visible";

          // Scrolls to the bottom of the page
          window.scrollTo({
            top: document.body.scrollHeight,
            behavior: 'smooth' // Enables smooth scrolling
          });

          document.getElementById("NewAddress_lat").value=lat;
          document.getElementById("NewAddress_lng").value=lng;


          document.getElementById("autoCompleteAddresses").paddingBottom=`0px`;
            document.getElementById("autoCompleteAddresses").innerHTML=``;
            const newPosition = L.latLng(lat, lng); // Create a LatLng object
            map.setView(newPosition, 14); // Set map center
            draggableMarker.setLatLng(newPosition); // Move marker to new position
        }
        
        // Event listener for drag end
        draggableMarker.on('dragend', function (event) {
            const position = event.target.getLatLng(); // Get the marker's position
            console.log("Latitude:", position.lat, "Longitude:", position.lng); // Log to console
            // alert(`Pin Position:\nLatitude: ${position.lat}, Longitude: ${position.lng}`);
            map.setView(position, map.getZoom());

        });

  

</script>


<script>
  const enableButton = document.getElementById("enableLocation");
  const locationOutput = document.getElementById("locationOutput");

  enableButton.addEventListener("click", () => {
      if ("geolocation" in navigator) {
          // locationOutput.innerHTML = "Getting location...";
          navigator.geolocation.getCurrentPosition(
              async (position) => {
                  const { latitude, longitude } = position.coords;

                  await setMapPosition(latitude,longitude);
                  // Display latitude and longitude
                  // locationOutput.innerHTML = `
                  //     <p><strong>Latitude:</strong> ${latitude}</p>
                  //     <p><strong>Longitude:</strong> ${longitude}</p>
                  // `;

                 
                  // Fetch detailed address using Nominatim
                  try {
                      const url = `https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json&addressdetails=1`;
                      const response = await fetch(url);
                      if (!response.ok) throw new Error("Unable to fetch address.");
                      const data = await response.json();

                      // Extract details
                      const address = data.display_name || "Address not available";
                      const pincode = data.address.postcode || "Pincode not available";
                      const city = data.address.city || data.address.town || "City not available";

                      console.log(address);
                  console.log(pincode);
                  console.log(position.coords);
                  
                      // Update location details

                      // locationOutput.innerHTML += `
                      //     <p><strong>Address:</strong> ${address}</p>
                      //     <p><strong>Pincode:</strong> ${pincode}</p>
                      //     <p><strong>City:</strong> ${city}</p>
                      // `;
                  } catch (error) {
                      console.error(error);
                      // locationOutput.innerHTML += "<p>Unable to fetch address details.</p>";
                  }
              },
              (error) => {
                  // Handle geolocation errors
                  // locationOutput.innerHTML = `<p>Error: ${error.message}</p>`;
              }
          );
      } else {
          locationOutput.innerHTML = "<p>Geolocation is not supported by your browser.</p>";
      }
  });
</script>

<script>
  
window.onload = async function() {
    try {
        // Send a GET request to fetch the total items in the cart
        const response = await axios.get('/getUserAddresses');
        
        // Check if the request was successful
        if (response.data.success) {
            // Update the innerHTML of the cartCount element with the total items count
           console.log(response.data.message)
           console.log(response.data.message.length)

           if(response.data.message.length){
            document.getElementById("savedAddress").style.display="block";
           }

           for(var i=0;i<response.data.message.length;i++){
              document.getElementById("allSavedAddressSection").innerHTML+=`
                <div class="suggestion-item"  style="padding: 10px;
    font-family: var(--default-font-family);
    margin-bottom: 10px;
    margin-top: 10px;cursor:pointer" onclick="selectSavedAddress('${response.data.message[i].category}', '${response.data.message[i].fullAddress}' , '${response.data.message[i].address_id}' )">
                          <strong id="addressCategory" style=" font-family: var(--default-font-family);">${response.data.message[i].category}</strong> <br>
                          <small id="addressFull" style=" font-family: var(--default-font-family);">${response.data.message[i].fullAddress}</small>
                      </div>
              `
           }
        } else {
            // Handle the error if cart count retrieval fails
            console.error("Failed to fetch Address ");
        }
    } catch (error) {
        // Handle any errors from the API request
        console.error("Error fetching Address", error);
    }
};
</script>

</html>
